<html>
<head><!--Xbase href="http://charles.karney.info/misc/secret.html"Y-->
<title>Implementation of Shamir's method for sharing a secret</title>
<meta name="description" content="Implementation of Shamir's method for sharing a secret">
<meta name="author" content="Charles F. F. Karney">
</head>
<body topmargin=10 leftmargin=10>
<h3>Implementation of Shamir's method for sharing a secret</h3>

The two perl scripts
<a href="shares.pl">shares.pl</a> and
<a href="reconstruct.pl">reconstruct.pl</a>
implement Shamir's algorithm for key sharing described in
<blockquote>
     <a href="http://www.wisdom.weizmann.ac.il/math/profile/scientists/shamir-profile.html">A. Shamir</a>,
<br> <a href="http://szabo.best.vwh.net/secret.html">How to Share a Secret</a>,
<br> Comm. ACM <b>22</b>, 612&ndash;613 (1979).
</blockquote>
This is useful for encrypting backup tapes.  The encryption key for the
backup needs to be on the computer doing the backups.  However it also
needs to be stored in another location in case of a disk failure on that
computer.  However merely writing the key onto a floppy disk is dangerous
in case the floppy disk falls into the wrong hands (or is lost!).

<p>Shamir's method allow the key to be split into <i>N</i> pieces in
such a way that any <i>K</i> piece suffice to reconstruct the key but
knowledge of only <i>K</i> &minus; 1 pieces yields no information on the
key.

<p>This implementation was written by
<a href="mailto:charles@karney.com">Charles Karney</a>
in 2001 and is licensed under the GPL.  For more information, see
<a href="http://charles.karney.info/misc/secret.html">
http://charles.karney.info/misc/secret.html</a>.

<p>In this implementation we require 0 &lt; <i>K</i> &le; <i>N</i> &le;
256.  Here's how this might work with (<i>K</i>,<i>N</i>) = (3,5)
<ol>
<li>
    generate a printable secret key (in this example, 36 &times; 8 =
    288 bits or 36 &times; 8/6 = 48 characters)
<blockquote>
      cp /dev/null SECRET
<br>  chmod 600 SECRET
<br>  dd if=/dev/random bs=1 count=36 2&gt;/dev/null |
      base64-encode &gt;&gt; SECRET
</blockquote>
    base64-encode converts binary data to printable form.  If it's not
    available use some other procedure for accomplishing this.
<li>
    Split the key up into <i>N</i> = 5 pieces
<blockquote>
      cat SECRET | ./<a href="shares.pl">shares.pl</a> 3 5
</blockquote>
    This produces <i>N</i> lines of output which need to be written to
    <i>N</i> floppy disks together with <i>N</i> copies of
    <a href="reconstruct.pl">reconstruct.pl</a>.  Store these disks in
    <i>N</i> separate secure locations.
<li>
    If the original SECRET gets destroyed, gather <i>K</i> = 3 or more
    of the floppy disks and feed the shared keys to <a
    href="reconstruct.pl">reconstruct.pl</a>, thus 
<blockquote>
      ./<a href="reconstruct.pl">reconstruct.pl</a> &lt;&lt;EOF
<br>  share5
<br>  share1
<br>  share2
<br>  EOF
</blockquote>
    The output will be the original secret.
<li>
    If some number &lt; <i>K</i> of floppy disks are stolen or mislaid,
    then <b>immediately</b> generate a new set of <i>N</i> floppy disks
    (see step 2), and <b>destroy</b> at least <i>N</i> &minus; <i>K</i>
    + 1 of the remaining disks.
<li>
    If some number &ge; <i>K</i> of floppy disks are stolen or mislaid,
    then generate a new encryption key, and re-encrypt the existing
    backup tapes.
</ol>

<p>Here's how tapes can be encrypted with gpg and the SECRET.
<ol>
<li>
    use the key for encryption by gpg during a dump
<blockquote>
      (cat SECRET; DUMP-DATA) |
<br>  gpg -c --passphrase-fd 0 |
<br>  buffer -s 64k -m 32m -t &gt; $TAPE
</blockquote>
    DUMP-DATA is whatever generates the backup data (tar, dump, etc.)
<li>
     use the key for decryption during a restore
<blockquote>
      (cat SECRET; dd if=$TAPE bs=64k 2&gt; /dev/null) |
<br>  gpg  --passphrase-fd 0 |
<br>  UNDUMP-DATA
</blockquote>
    UNDUMP-DATA is the inverse of DUMP-DATA.
</ol>
<hr>
<address><a href="../index.html">Charles Karney</a> (2001-08-21)</address>
<a href="../index.html">Back to index.</a>
</body></html>
