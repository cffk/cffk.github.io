<html>
<head><!--Xbase href="http://charles.karney.info/misc/bitmap.html"Y-->
<title>Conversion from PBM bitmap format to PostScript</title>
<meta name="description" content="Conversion from PBM bitmap format to PostScript">
<meta name="author" content="Charles F. F. Karney">
</head>
<body topmargin=10 leftmargin=10>
<h3>Conversion from PBM bitmap format to PostScript</h3>

<h4>Introduction</h4>
<p>
This describes my efforts to submit some old
<a href="http://www.pppl.gov">PPPL</a> reports to
<a href="http://arxiv.org">http://arxiv.org</a>.  The text for these
were written in TeX or LaTeX, but at the time the reports were written
there was no provision to include graphics in TeX output.  In those
days, figures were submitted to journals as glossy photographs.  For the
arxiv submissions,  I therefore scanned the figures from paper copies of
the reports and reran LaTeX including the scanned figures.  The discussion
here supplements the advice given at
<a href="http://arxiv.org/help/bitmap">http://arxiv.org/help/bitmap</a>.

<h4>Black &amp; white or gray?</h4>
<p>
I initially assumed that scanning the figures as gray-scale images would
be preferable.  After all, that was the way to avoid the
&ldquo;jaggies&rdquo;.  However, I eventually persuaded myself that
black &amp; white images were better for two reasons:
<ol>
<li>
Black &amp; white scans at 300 dots per inch result in a legible printed
version.
<li>
These can be compressed really well as PostScript (as we shall see).
<li>
The various tools that produce PDF files have a nasty habit of using
lossy compression for gray and color images (which give a horrible
blotched effect with line drawings), but always use  lossless
compression for bitmaps.
<li>
Black &amp; white scans result in less &ldquo;background&rdquo; noise,
e.g., from the printing on the other side of the paper.
<li>
Printers do not print grays consistently.  Thus you might be happy with
a gray image as printed on one printer, but find that the apparently
&ldquo;white&rdquo; background prints with gray splotches on another
printer.
</ol>
Scanning as gray-scale is useful however if you need to fiddle with the
threshold between black and white.  In this case, convert the scanned
image to a bitmap with <tt>pgmtopbm -threshold -value 0.7</tt>, for
example.  Gray-scale is also better to correct a rotation in the image
(for example, if the paper feed on your scanner sometimes misaligns the
paper); this can be corrected with pnmrotate, followed by pgmtopbm.

<p>
<font size="-1">
An aside: pnmrotate uses 3 shears to implement the rotation and the
manual page credits the method to
<blockquote>
<a href="mailto:awpaeth@ouc.bc.ca">Alan W. Paeth</a>,<br>
&ldquo;A Fast Algorithm for General Raster Rotation&rdquo;,<br>
Proc. Graphics Interface '86, Canadian Information Processing Soc.,
pp. 77&ndash;81, May 1986.
</blockquote>
In fact, I had discovered the same method a year earlier.  See Section V of
<blockquote>
Charles F. F. Karney,<br>
&ldquo;<a href="../biblio/karney86a.html">Numerical techniques for the study of
long-time correlations</a>&rdquo;,<br>
<em>Particle Accelerators</em>, 19(1&ndash;4):213&ndash;221, May 1986<br>
[Proc. Workshop on Orbital Dynamics and Applications to Accelerators,
Berkeley, CA, Mar. 7&ndash;12, 1985;<br>
Princeton Univ. Rept. PPPL&ndash;2218 (May 1985) 9 pp.]
</blockquote>
The same method is also described in
<blockquote>
A. Tanaka, M. Kameyama, S. Kazama, and O. Watanabe,<br>
&ldquo;A Rotation Method for Raster Image Using Skew Transformation&rdquo;,<br>
Proc. IEEE Conference on Computer Vision and Pattern Recognition,
pp. 272&ndash;277, June 1986.
</blockquote>
</font>

<h4>Useful formats</h4>
<ul>
<li>PBM, raw bitmap format of
<a href="http://netpbm.sourceforge.net">netpbm</a> package.
<li>PS, PostScript&mdash;can be inserted as graphics by LaTeX.
<li>PNG, lossless compressed image format, one of the standard image
formats for the web&mdash;can be inserted as graphics by pdflatex.
<li>PDF, portable document format&mdash;can be inserted as graphics by
pdflatex.
</ul>
<p>
Here is a test on the bitmap image <a href="test.png">test.png</a> (this
is figure 8 from
<a href="http://arxiv.org/abs/nlin.CD/0501023">arxiv:nlin.CD/0501023</a>).
This image is a 2021 &times; 1956 scan at 300 dpi of a paper copy of the
figure.  The following table shows the size of the image file in various
formats.
<center>
<table border=1 rules="groups">
<colgroup><col width=200><col>
<thead>
<tr><th>format<th>size (kbytes)
<tbody>
<tr><td>PBM (raw)<td>484
<tr><td>PNG (-compress 9)<td> 27
<tr><td>PDF<td> 14
<tr><td>PS (pnmtops) <td>984
<tr><td>PS (pnmtops -rle) <td>139
<tr><td>PS (imgtops -2, v 1.0) <td>148
<tr><td>PS (imgtops -3, v 1.0) <td> 64
<tr><td>PS (imgtops -2, v 1.0a) <td> 92
<tr><td>PS (imgtops -3, v 1.0a) <td> 40
<tr><td>PS (tiff2ps)<td> 18
</table>
</center>
<p>
The PNG file is produced with
<blockquote>
<pre>
res=300
resm=`expr '(' 10000 '*' $res + 127 ')' / 254` # dots/meter
pnmtopng -compress 9 -size "$resm $resm 1" test.pbm > test.png
</pre>
</blockquote>
The PDF file is produced with
<blockquote>
<pre>
res=300
pnmtops -dpi $res -equalpixels -noturn -rle -nosetpage test.pbm |
  epstopdf --filter > test.pdf
</pre>
</blockquote>
Surprisingly, PDF offers much better compression than PNG for bitmaps.
Thus PDF is the preferred format for inclusion of bitmap graphics using
pdflatex.

<p>
In order to include graphics with latex, it is necessary to convert the
image to PostScript and here we have several options.
<ul>
<li>
pnmtops is part of the
<a href="http://netpbm.sourceforge.net">netpbm</a> package. -rle turns
on run length encoding.
<li>
imgtops is an program written by
<a href="mailto:dougz@isotropic.org">Doug Zongker</a> and available at
<a href="http://imgtops.sourceforge.net/">http://imgtops.sourceforge.net/</a>.
Version 1.0 has a &ldquo;bug&rdquo; where it treats a bitmap as an 8-bit
image.  This is fixed in the CVS repository (changes dated 2005-01-01),
which I call version 1.0a.  -3 emits Level 3 PostScript which will
<em>not</em> print correctly on Level 2 PostScript printers and this
is therefore not a suitable format for distributing graphics.
<li>
tiff2ps is part of the <a href="http://www.libtiff.org/">LibTIFF</a>
package.
</ul>

The clear winner here is tiff2ps.  This uses the same compression as
PDF, with the ratio in the resulting files sizes being 4:5 due to
encoding the binary image in ASCII85.  The file prints OK on a Level 2
PostScript printer. (However, on some models printing may be slow.
Printing on an HP LaserJet 2100M is about 7 times slower than the
output of pnmtops.  Printing on  an HP LaserJet 4m Plus, on the other
hand, is about 30% faster that the output to pnmtops.)  I found it
convenient to write a script, <a href="pbmtops.sh">pbmtops</a>, to
convert a PBM file to PostScript via tiff2ps.  I include a comment in
pbmtops indicating how to convert the PostScript file so that black and
white are replaced by some other colors&mdash;I'm not sure how useful
this will be in practice.  pbmtops calls
<a href="dscframe.sh">dscframe</a>, which puts DSC comments around the
image so that other software can skip over the image quickly.  It also
means that it's OK for an image line to begin with %%.

<h4>Recommendations</h4>
<ul>
<li>
Scan images as bitmaps at 300 dpi.
<li>
For more flexibility, scan in gray scale and then convert to a bitmap
with <tt>pgmtopbm -threshold</tt>.
<li>
Convert bitmap to PDF format for inclusion of graphics with pdflatex.
<li>
Convert bitmap to PS format (using pbmtops script given above) for
inclusion of graphics with latex and for submission of graphics to
arxiv.org.
</ul>

<hr>
<address><a href="../index.html">Charles Karney</a> (2005-06-27)</address>
<a href="../index.html">Back to index.</a>
</body></html>
